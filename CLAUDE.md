# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

子供向け「神経衰弱」ゲームの実装。HTML/CSS/JavaScriptによる静的なWebアプリケーションで、サーバー不要のローカル動作を前提とする。

## 開発コマンド

```bash
# ローカルサーバー起動（開発用）
python3 -m http.server 8000
# または
npx serve .

# ブラウザでアクセス
open http://localhost:8000
```

## アーキテクチャ

### ファイル構成
- **index.html** - ゲームのマークアップ（スタート画面、ゲーム盤面、結果表示）
- **styles.css** - 緑基調のデザイン、カードフリップアニメーション
- **script.js** - ゲームロジック全般（JSDoc型注釈付き）
- **_docs/** - 要件定義と実装ログ

### ゲーム仕様
- **デッキ**: トランプ52枚（ジョーカー除く）
- **マッチ条件**: 同ランクでペア成立（例: A♠とA♥）
- **総ペア数**: 26ペア
- **得点システム**:
  - 通常ペア: 1点
  - 最後の5ペア: 2点（残りペア数が5以下の時）
- **プレイヤー**: 2人対戦
- **手番ルール**: マッチ時は継続、ミスマッチで交代

### 主要な状態管理（GameState）
```javascript
{
  deck: Card[],           // 52枚のカード配列
  matched: Set<string>,   // 取得済みカードID
  revealed: string[],     // 現在表示中のカードID（最大2枚）
  scores: [number, number], // P1, P2のスコア
  currentPlayer: number,  // 現在の手番（1 or 2）
  inputLocked: boolean,   // アニメーション中の入力制御
  pairsRemaining: number, // 残りペア数
  started: boolean        // ゲーム状態
}
```

### UI操作フロー
1. **ゲーム開始**: スタートボタン → カード配置 → 手番開始
2. **カード選択**: 2枚選択 → 判定
3. **ミスマッチ時**: 「カードを伏せる」ボタンで手動裏返し → 手番交代
4. **マッチ時**: 自動でカード除去、得点加算、手番継続
5. **シャッフル**: ゲーム中いつでも盤面シャッフル可能（表カードがない時）
6. **ゲーム終了**: 全ペア取得 → 結果表示 → 再スタート

## コード規約

### JavaScript
- **型注釈**: JSDocによる型定義を全関数に付与
- **関数設計**: 単一責任原則、小さく焦点を絞った関数
- **変数命名**: 説明的で意図が明確な名前
- **エラー処理**: 想定外の状態に対する安全な処理

### DOM操作パターン
- カード要素は`data-card-id`属性で識別
- クラス名による状態管理:
  - `is-flipped`: カード表示状態
  - `matched`: 取得済みカード
  - `removed`: 視覚的に除去
  - `hidden`: 要素非表示

### アニメーション
- カードフリップ: CSS transform3d使用
- トランジション: 0.6秒の3D回転効果
- 取得時: フェードアウト + スケールダウン

## 実装上の注意点

1. **入力制御**: アニメーション中は`inputLocked`で多重操作を防止
2. **手動裏返し**: ミスマッチ時は自動裏返しせず、ユーザー操作を待つ
3. **シャッフル機能**: Fisher-Yatesアルゴリズムで盤面再配置
4. **得点計算**: ペア取得時の残数で判定（5以下なら2点）

## 実装ログ管理

新機能実装時は`_docs/yyyy-mm-dd_機能名.md`形式でログを作成:
- 実装内容の詳細
- 設計上の判断理由
- 未対応事項と今後の改善案